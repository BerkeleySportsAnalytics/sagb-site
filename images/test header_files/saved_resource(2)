/*! This file is auto-generated */
!function(){function t(){}var n=this,r=n._,e=Array.prototype,o=Object.prototype,u=Function.prototype,i=e.push,c=e.slice,l=o.toString,a=o.hasOwnProperty,f=Array.isArray,s=Object.keys,p=u.bind,h=Object.create,v=function(n){return n instanceof v?n:this instanceof v?void(this._wrapped=n):new v(n)};"undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=v:exports)._=v:n._=v,v.VERSION="1.8.3";var y=function(u,i,n){if(void 0===i)return u;switch(null==n?3:n){case 1:return function(n){return u.call(i,n)};case 2:return function(n,t){return u.call(i,n,t)};case 3:return function(n,t,r){return u.call(i,n,t,r)};case 4:return function(n,t,r,e){return u.call(i,n,t,r,e)}}return function(){return u.apply(i,arguments)}},d=function(n,t,r){return null==n?v.identity:v.isFunction(n)?y(n,t,r):v.isObject(n)?v.matcher(n):v.property(n)};v.iteratee=function(n,t){return d(n,t,1/0)};function g(n){return v.isObject(n)?h?h(n):(t.prototype=n,n=new t,t.prototype=null,n):{}}var m=function(c,f){return function(n){var t=arguments.length;if(t<2||null==n)return n;for(var r=1;r<t;r++)for(var e=arguments[r],u=c(e),i=u.length,o=0;o<i;o++){var a=u[o];f&&void 0!==n[a]||(n[a]=e[a])}return n}},b=function(t){return function(n){return null==n?void 0:n[t]}},x=Math.pow(2,53)-1,_=b("length"),j=function(n){n=_(n);return"number"==typeof n&&0<=n&&n<=x};function w(a){return function(n,t,r,e){t=y(t,e,4);var u=!j(n)&&v.keys(n),i=(u||n).length,o=0<a?0:i-1;return arguments.length<3&&(r=n[u?u[o]:o],o+=a),function(n,t,r,e,u,i){for(;0<=u&&u<i;u+=a){var o=e?e[u]:u;r=t(r,n[o],o,n)}return r}(n,t,r,u,o,i)}}v.each=v.forEach=function(n,t,r){if(t=y(t,r),j(n))for(u=0,i=n.length;u<i;u++)t(n[u],u,n);else for(var e=v.keys(n),u=0,i=e.length;u<i;u++)t(n[e[u]],e[u],n);return n},v.map=v.collect=function(n,t,r){t=d(t,r);for(var e=!j(n)&&v.keys(n),u=(e||n).length,i=Array(u),o=0;o<u;o++){var a=e?e[o]:o;i[o]=t(n[a],a,n)}return i},v.reduce=v.foldl=v.inject=w(1),v.reduceRight=v.foldr=w(-1),v.find=v.detect=function(n,t,r){r=j(n)?v.findIndex(n,t,r):v.findKey(n,t,r);if(void 0!==r&&-1!==r)return n[r]},v.filter=v.select=function(n,e,t){var u=[];return e=d(e,t),v.each(n,function(n,t,r){e(n,t,r)&&u.push(n)}),u},v.reject=function(n,t,r){return v.filter(n,v.negate(d(t)),r)},v.every=v.all=function(n,t,r){t=d(t,r);for(var e=!j(n)&&v.keys(n),u=(e||n).length,i=0;i<u;i++){var o=e?e[i]:i;if(!t(n[o],o,n))return!1}return!0},v.some=v.any=function(n,t,r){t=d(t,r);for(var e=!j(n)&&v.keys(n),u=(e||n).length,i=0;i<u;i++){var o=e?e[i]:i;if(t(n[o],o,n))return!0}return!1},v.contains=v.includes=v.include=function(n,t,r,e){return j(n)||(n=v.values(n)),0<=v.indexOf(n,t,r="number"!=typeof r||e?0:r)},v.invoke=function(n,r){var e=c.call(arguments,2),u=v.isFunction(r);return v.map(n,function(n){var t=u?r:n[r];return null==t?t:t.apply(n,e)})},v.pluck=function(n,t){return v.map(n,v.property(t))},v.where=function(n,t){return v.filter(n,v.matcher(t))},v.findWhere=function(n,t){return v.find(n,v.matcher(t))},v.max=function(n,e,t){var r,u,i=-1/0,o=-1/0;if(null==e&&null!=n)for(var a=0,c=(n=j(n)?n:v.values(n)).length;a<c;a++)r=n[a],i<r&&(i=r);else e=d(e,t),v.each(n,function(n,t,r){u=e(n,t,r),(o<u||u===-1/0&&i===-1/0)&&(i=n,o=u)});return i},v.min=function(n,e,t){var r,u,i=1/0,o=1/0;if(null==e&&null!=n)for(var a=0,c=(n=j(n)?n:v.values(n)).length;a<c;a++)(r=n[a])<i&&(i=r);else e=d(e,t),v.each(n,function(n,t,r){((u=e(n,t,r))<o||u===1/0&&i===1/0)&&(i=n,o=u)});return i},v.shuffle=function(n){for(var t,r=j(n)?n:v.values(n),e=r.length,u=Array(e),i=0;i<e;i++)(t=v.random(0,i))!==i&&(u[i]=u[t]),u[t]=r[i];return u},v.sample=function(n,t,r){return null==t||r?(n=!j(n)?v.values(n):n)[v.random(n.length-1)]:v.shuffle(n).slice(0,Math.max(0,t))},v.sortBy=function(n,e,t){return e=d(e,t),v.pluck(v.map(n,function(n,t,r){return{value:n,index:t,criteria:e(n,t,r)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(e<r||void 0===r)return 1;if(r<e||void 0===e)return-1}return n.index-t.index}),"value")};u=function(i){return function(r,e,n){var u={};return e=d(e,n),v.each(r,function(n,t){t=e(n,t,r);i(u,n,t)}),u}};v.groupBy=u(function(n,t,r){v.has(n,r)?n[r].push(t):n[r]=[t]}),v.indexBy=u(function(n,t,r){n[r]=t}),v.countBy=u(function(n,t,r){v.has(n,r)?n[r]++:n[r]=1}),v.toArray=function(n){return n?v.isArray(n)?c.call(n):j(n)?v.map(n,v.identity):v.values(n):[]},v.size=function(n){return null==n?0:(j(n)?n:v.keys(n)).length},v.partition=function(n,e,t){e=d(e,t);var u=[],i=[];return v.each(n,function(n,t,r){(e(n,t,r)?u:i).push(n)}),[u,i]},v.first=v.head=v.take=function(n,t,r){if(null!=n)return null==t||r?n[0]:v.initial(n,n.length-t)},v.initial=function(n,t,r){return c.call(n,0,Math.max(0,n.length-(null==t||r?1:t)))},v.last=function(n,t,r){if(null!=n)return null==t||r?n[n.length-1]:v.rest(n,Math.max(0,n.length-t))},v.rest=v.tail=v.drop=function(n,t,r){return c.call(n,null==t||r?1:t)},v.compact=function(n){return v.filter(n,v.identity)};var A=function(n,t,r,e){for(var u=[],i=0,o=e||0,a=_(n);o<a;o++){var c=n[o];if(j(c)&&(v.isArray(c)||v.isArguments(c))){var f=0,l=(c=!t?A(c,t,r):c).length;for(u.length+=l;f<l;)u[i++]=c[f++]}else r||(u[i++]=c)}return u};function O(i){return function(n,t,r){t=d(t,r);for(var e=_(n),u=0<i?0:e-1;0<=u&&u<e;u+=i)if(t(n[u],u,n))return u;return-1}}function k(i,o,a){return function(n,t,r){var e=0,u=_(n);if("number"==typeof r)0<i?e=0<=r?r:Math.max(r+u,e):u=0<=r?Math.min(r+1,u):r+u+1;else if(a&&r&&u)return n[r=a(n,t)]===t?r:-1;if(t!=t)return 0<=(r=o(c.call(n,e,u),v.isNaN))?r+e:-1;for(r=0<i?e:u-1;0<=r&&r<u;r+=i)if(n[r]===t)return r;return-1}}v.flatten=function(n,t){return A(n,t,!1)},v.without=function(n){return v.difference(n,c.call(arguments,1))},v.uniq=v.unique=function(n,t,r,e){v.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=d(r,e));for(var u=[],i=[],o=0,a=_(n);o<a;o++){var c=n[o],f=r?r(c,o,n):c;t?(o&&i===f||u.push(c),i=f):r?v.contains(i,f)||(i.push(f),u.push(c)):v.contains(u,c)||u.push(c)}return u},v.union=function(){return v.uniq(A(arguments,!0,!0))},v.intersection=function(n){for(var t=[],r=arguments.length,e=0,u=_(n);e<u;e++){var i=n[e];if(!v.contains(t,i)){for(var o=1;o<r&&v.contains(arguments[o],i);o++);o===r&&t.push(i)}}return t},v.difference=function(n){var t=A(arguments,!0,!0,1);return v.filter(n,function(n){return!v.contains(t,n)})},v.zip=function(){return v.unzip(arguments)},v.unzip=function(n){for(var t=n&&v.max(n,_).length||0,r=Array(t),e=0;e<t;e++)r[e]=v.pluck(n,e);return r},v.object=function(n,t){for(var r={},e=0,u=_(n);e<u;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},v.findIndex=O(1),v.findLastIndex=O(-1),v.sortedIndex=function(n,t,r,e){for(var u=(r=d(r,e,1))(t),i=0,o=_(n);i<o;){var a=Math.floor((i+o)/2);r(n[a])<u?i=a+1:o=a}return i},v.indexOf=k(1,v.findIndex,v.sortedIndex),v.lastIndexOf=k(-1,v.findLastIndex),v.range=function(n,t,r){null==t&&(t=n||0,n=0),r=r||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;i<e;i++,n+=r)u[i]=n;return u};function F(n,t,r,e,u){return e instanceof t?(r=g(n.prototype),u=n.apply(r,u),v.isObject(u)?u:r):n.apply(r,u)}v.bind=function(n,t){if(p&&n.bind===p)return p.apply(n,c.call(arguments,1));if(!v.isFunction(n))throw new TypeError("Bind must be called on a function");var r=c.call(arguments,2),e=function(){return F(n,e,t,this,r.concat(c.call(arguments)))};return e},v.partial=function(u){var i=c.call(arguments,1),o=function(){for(var n=0,t=i.length,r=Array(t),e=0;e<t;e++)r[e]=i[e]===v?arguments[n++]:i[e];for(;n<arguments.length;)r.push(arguments[n++]);return F(u,o,this,this,r)};return o},v.bindAll=function(n){var t,r,e=arguments.length;if(e<=1)throw new Error("bindAll must be passed function names");for(t=1;t<e;t++)n[r=arguments[t]]=v.bind(n[r],n);return n},v.memoize=function(e,u){var i=function(n){var t=i.cache,r=""+(u?u.apply(this,arguments):n);return v.has(t,r)||(t[r]=e.apply(this,arguments)),t[r]};return i.cache={},i},v.delay=function(n,t){var r=c.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},v.defer=v.partial(v.delay,v,1),v.throttle=function(r,e,u){var i,o,a,c=null,f=0;u=u||{};function l(){f=!1===u.leading?0:v.now(),c=null,a=r.apply(i,o),c||(i=o=null)}return function(){var n=v.now();f||!1!==u.leading||(f=n);var t=e-(n-f);return i=this,o=arguments,t<=0||e<t?(c&&(clearTimeout(c),c=null),f=n,a=r.apply(i,o),c||(i=o=null)):c||!1===u.trailing||(c=setTimeout(l,t)),a}},v.debounce=function(t,r,e){var u,i,o,a,c,f=function(){var n=v.now()-a;n<r&&0<=n?u=setTimeout(f,r-n):(u=null,e||(c=t.apply(o,i),u||(o=i=null)))};return function(){o=this,i=arguments,a=v.now();var n=e&&!u;return u=u||setTimeout(f,r),n&&(c=t.apply(o,i),o=i=null),c}},v.wrap=function(n,t){return v.partial(t,n)},v.negate=function(n){return function(){return!n.apply(this,arguments)}},v.compose=function(){var r=arguments,e=r.length-1;return function(){for(var n=e,t=r[e].apply(this,arguments);n--;)t=r[n].call(this,t);return t}},v.after=function(n,t){return function(){if(--n<1)return t.apply(this,arguments)}},v.before=function(n,t){var r;return function(){return 0<--n&&(r=t.apply(this,arguments)),n<=1&&(t=null),r}},v.once=v.partial(v.before,2);var S=!{toString:null}.propertyIsEnumerable("toString"),E=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function M(n,t){var r=E.length,e=n.constructor,u=v.isFunction(e)&&e.prototype||o,i="constructor";for(v.has(n,i)&&!v.contains(t,i)&&t.push(i);r--;)(i=E[r])in n&&n[i]!==u[i]&&!v.contains(t,i)&&t.push(i)}v.keys=function(n){if(!v.isObject(n))return[];if(s)return s(n);var t,r=[];for(t in n)v.has(n,t)&&r.push(t);return S&&M(n,r),r},v.allKeys=function(n){if(!v.isObject(n))return[];var t,r=[];for(t in n)r.push(t);return S&&M(n,r),r},v.values=function(n){for(var t=v.keys(n),r=t.length,e=Array(r),u=0;u<r;u++)e[u]=n[t[u]];return e},v.mapObject=function(n,t,r){t=d(t,r);for(var e,u=v.keys(n),i=u.length,o={},a=0;a<i;a++)o[e=u[a]]=t(n[e],e,n);return o},v.pairs=function(n){for(var t=v.keys(n),r=t.length,e=Array(r),u=0;u<r;u++)e[u]=[t[u],n[t[u]]];return e},v.invert=function(n){for(var t={},r=v.keys(n),e=0,u=r.length;e<u;e++)t[n[r[e]]]=r[e];return t},v.functions=v.methods=function(n){var t,r=[];for(t in n)v.isFunction(n[t])&&r.push(t);return r.sort()},v.extend=m(v.allKeys),v.extendOwn=v.assign=m(v.keys),v.findKey=function(n,t,r){t=d(t,r);for(var e,u=v.keys(n),i=0,o=u.length;i<o;i++)if(t(n[e=u[i]],e,n))return e},v.pick=function(n,t,r){var e,u,i={},o=n;if(null==o)return i;v.isFunction(t)?(u=v.allKeys(o),e=y(t,r)):(u=A(arguments,!1,!1,1),e=function(n,t,r){return t in r},o=Object(o));for(var a=0,c=u.length;a<c;a++){var f=u[a],l=o[f];e(l,f,o)&&(i[f]=l)}return i},v.omit=function(n,t,r){var e;return t=v.isFunction(t)?v.negate(t):(e=v.map(A(arguments,!1,!1,1),String),function(n,t){return!v.contains(e,t)}),v.pick(n,t,r)},v.defaults=m(v.allKeys,!0),v.create=function(n,t){n=g(n);return t&&v.extendOwn(n,t),n},v.clone=function(n){return v.isObject(n)?v.isArray(n)?n.slice():v.extend({},n):n},v.tap=function(n,t){return t(n),n},v.isMatch=function(n,t){var r=v.keys(t),e=r.length;if(null==n)return!e;for(var u=Object(n),i=0;i<e;i++){var o=r[i];if(t[o]!==u[o]||!(o in u))return!1}return!0};var I=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof v&&(n=n._wrapped),t instanceof v&&(t=t._wrapped);var u=l.call(n);if(u!==l.call(t))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!=+n?+t!=+t:0==+n?1/+n==1/t:+n==+t;case"[object Date]":case"[object Boolean]":return+n==+t}var i="[object Array]"===u;if(!i){if("object"!=typeof n||"object"!=typeof t)return!1;var o=n.constructor,u=t.constructor;if(o!==u&&!(v.isFunction(o)&&o instanceof o&&v.isFunction(u)&&u instanceof u)&&"constructor"in n&&"constructor"in t)return!1}e=e||[];for(var a=(r=r||[]).length;a--;)if(r[a]===n)return e[a]===t;if(r.push(n),e.push(t),i){if((a=n.length)!==t.length)return!1;for(;a--;)if(!I(n[a],t[a],r,e))return!1}else{var c,f=v.keys(n),a=f.length;if(v.keys(t).length!==a)return!1;for(;a--;)if(c=f[a],!v.has(t,c)||!I(n[c],t[c],r,e))return!1}return r.pop(),e.pop(),!0};v.isEqual=function(n,t){return I(n,t)},v.isEmpty=function(n){return null==n||(j(n)&&(v.isArray(n)||v.isString(n)||v.isArguments(n))?0===n.length:0===v.keys(n).length)},v.isElement=function(n){return!(!n||1!==n.nodeType)},v.isArray=f||function(n){return"[object Array]"===l.call(n)},v.isObject=function(n){var t=typeof n;return"function"==t||"object"==t&&!!n},v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){v["is"+t]=function(n){return l.call(n)==="[object "+t+"]"}}),v.isArguments(arguments)||(v.isArguments=function(n){return v.has(n,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(v.isFunction=function(n){return"function"==typeof n||!1}),v.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},v.isNaN=function(n){return v.isNumber(n)&&n!==+n},v.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"===l.call(n)},v.isNull=function(n){return null===n},v.isUndefined=function(n){return void 0===n},v.has=function(n,t){return null!=n&&a.call(n,t)},v.noConflict=function(){return n._=r,this},v.identity=function(n){return n},v.constant=function(n){return function(){return n}},v.noop=function(){},v.property=b,v.propertyOf=function(t){return null==t?function(){}:function(n){return t[n]}},v.matcher=v.matches=function(t){return t=v.extendOwn({},t),function(n){return v.isMatch(n,t)}},v.times=function(n,t,r){var e=Array(Math.max(0,n));t=y(t,r,1);for(var u=0;u<n;u++)e[u]=t(u);return e},v.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},v.now=Date.now||function(){return(new Date).getTime()};m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},f=v.invert(m),b=function(t){function r(n){return t[n]}var n="(?:"+v.keys(t).join("|")+")",e=RegExp(n),u=RegExp(n,"g");return function(n){return e.test(n=null==n?"":""+n)?n.replace(u,r):n}};v.escape=b(m),v.unescape=b(f),v.result=function(n,t,r){t=null==n?void 0:n[t];return v.isFunction(t=void 0===t?r:t)?t.call(n):t};var N=0;v.uniqueId=function(n){var t=++N+"";return n?n+t:t},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};function B(n){return"\\"+R[n]}var T=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g;v.template=function(i,n,t){n=v.defaults({},n=!n&&t?t:n,v.templateSettings);var t=RegExp([(n.escape||T).source,(n.interpolate||T).source,(n.evaluate||T).source].join("|")+"|$","g"),o=0,a="__p+='";i.replace(t,function(n,t,r,e,u){return a+=i.slice(o,u).replace(q,B),o=u+n.length,t?a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":r?a+="'+\n((__t=("+r+"))==null?'':__t)+\n'":e&&(a+="';\n"+e+"\n__p+='"),n}),a+="';\n",a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+(a=!n.variable?"with(obj||{}){\n"+a+"}\n":a)+"return __p;\n";try{var r=new Function(n.variable||"obj","_",a)}catch(n){throw n.source=a,n}t=function(n){return r.call(this,n,v)},n=n.variable||"obj";return t.source="function("+n+"){\n"+a+"}",t},v.chain=function(n){n=v(n);return n._chain=!0,n};function K(n,t){return n._chain?v(t).chain():t}v.mixin=function(r){v.each(v.functions(r),function(n){var t=v[n]=r[n];v.prototype[n]=function(){var n=[this._wrapped];return i.apply(n,arguments),K(this,t.apply(v,n))}})},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var r=e[t];v.prototype[t]=function(){var n=this._wrapped;return r.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],K(this,n)}}),v.each(["concat","join","slice"],function(n){var t=e[n];v.prototype[n]=function(){return K(this,t.apply(this._wrapped,arguments))}}),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return v})}.call(this);;
/*! This file is auto-generated */
!function(n){var s="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(t,e,i){s.Backbone=n(s,i,t,e)});else if("undefined"!=typeof exports){var t,e=require("underscore");try{t=require("jquery")}catch(t){}n(s,exports,e,t)}else s.Backbone=n(s,{},s._,s.jQuery||s.Zepto||s.ender||s.$)}(function(t,h,b,e){var i=t.Backbone,o=Array.prototype.slice;h.VERSION="1.4.0",h.$=e,h.noConflict=function(){return t.Backbone=i,this},h.emulateHTTP=!1,h.emulateJSON=!1;var a,n=h.Events={},u=/\s+/,c=function(t,e,i,n,s){var r,o=0;if(i&&"object"==typeof i){void 0!==n&&"context"in s&&void 0===s.context&&(s.context=n);for(r=b.keys(i);o<r.length;o++)e=c(t,e,r[o],i[r[o]],s)}else if(i&&u.test(i))for(r=i.split(u);o<r.length;o++)e=t(e,r[o],n,s);else e=t(e,i,n,s);return e};n.on=function(t,e,i){return this._events=c(s,this._events||{},t,e,{context:i,ctx:this,listening:a}),a&&(((this._listeners||(this._listeners={}))[a.id]=a).interop=!1),this},n.listenTo=function(t,e,i){if(!t)return this;var n=t._listenId||(t._listenId=b.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),r=a=s[n];r||(this._listenId||(this._listenId=b.uniqueId("l")),r=a=s[n]=new g(this,t));t=l(t,e,i,this);if(a=void 0,t)throw t;return r.interop&&r.on(e,i),this};var s=function(t,e,i,n){var s,r;return i&&(s=t[e]||(t[e]=[]),r=n.context,e=n.ctx,(n=n.listening)&&n.count++,s.push({callback:i,context:r,ctx:r||e,listening:n})),t},l=function(t,e,i,n){try{t.on(e,i,n)}catch(t){return t}};n.off=function(t,e,i){return this._events&&(this._events=c(r,this._events,t,e,{context:i,listeners:this._listeners})),this},n.stopListening=function(t,e,i){var n=this._listeningTo;if(!n)return this;for(var s=t?[t._listenId]:b.keys(n),r=0;r<s.length;r++){var o=n[s[r]];if(!o)break;o.obj.off(e,i,this),o.interop&&o.off(e,i)}return b.isEmpty(n)&&(this._listeningTo=void 0),this};var r=function(t,e,i,n){if(t){var s,r=n.context,o=n.listeners,h=0;if(e||r||i){for(s=e?[e]:b.keys(t);h<s.length;h++){var a=t[e=s[h]];if(!a)break;for(var u=[],c=0;c<a.length;c++){var l=a[c];i&&i!==l.callback&&i!==l.callback._callback||r&&r!==l.context?u.push(l):(l=l.listening)&&l.off(e,i)}u.length?t[e]=u:delete t[e]}return t}for(s=b.keys(o);h<s.length;h++)o[s[h]].cleanup()}};n.once=function(t,e,i){var n=c(d,{},t,e,this.off.bind(this));return this.on(n,e="string"==typeof t&&null==i?void 0:e,i)},n.listenToOnce=function(t,e,i){i=c(d,{},e,i,this.stopListening.bind(this,t));return this.listenTo(t,i)};var d=function(t,e,i,n){var s;return i&&((s=t[e]=b.once(function(){n(e,s),i.apply(this,arguments)}))._callback=i),t};n.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return c(f,this._events,t,void 0,i),this};var f=function(t,e,i,n){var s,r;return t&&(s=t[e],r=t.all,s&&r&&(r=r.slice()),s&&p(s,n),r&&p(r,[e].concat(n))),t},p=function(t,e){var i,n=-1,s=t.length,r=e[0],o=e[1],h=e[2];switch(e.length){case 0:for(;++n<s;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r);return;case 2:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r,o);return;case 3:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r,o,h);return;default:for(;++n<s;)(i=t[n]).callback.apply(i.ctx,e);return}},g=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};g.prototype.on=n.on,g.prototype.off=function(t,e){e=this.interop?(this._events=c(r,this._events,t,e,{context:void 0,listeners:void 0}),!this._events):(this.count--,0===this.count);e&&this.cleanup()},g.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},n.bind=n.on,n.unbind=n.off,b.extend(h,n);var v=h.Model=function(t,e){var i=t||{};e=e||{},this.preinitialize.apply(this,arguments),this.cid=b.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var n=b.result(this,"defaults"),i=b.defaults(b.extend({},n,i),n);this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};b.extend(v.prototype,n,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return b.clone(this.attributes)},sync:function(){return h.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return b.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!b.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var n;if("object"==typeof t?(n=t,i=e):(n={})[t]=e,!this._validate(n,i=i||{}))return!1;var s=i.unset,r=i.silent,o=[],t=this._changing;this._changing=!0,t||(this._previousAttributes=b.clone(this.attributes),this.changed={});var h,a=this.attributes,u=this.changed,c=this._previousAttributes;for(h in n)e=n[h],b.isEqual(a[h],e)||o.push(h),b.isEqual(c[h],e)?delete u[h]:u[h]=e,s?delete a[h]:a[h]=e;if(this.idAttribute in n&&(this.id=this.get(this.idAttribute)),!r){o.length&&(this._pending=i);for(var l=0;l<o.length;l++)this.trigger("change:"+o[l],this,a[o[l]],i)}if(t)return this;if(!r)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,b.extend({},e,{unset:!0}))},clear:function(t){var e,i={};for(e in this.attributes)i[e]=void 0;return this.set(i,b.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!b.isEmpty(this.changed):b.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&b.clone(this.changed);var e,i,n=this._changing?this._previousAttributes:this.attributes,s={};for(i in t){var r=t[i];b.isEqual(n[i],r)||(s[i]=r,e=!0)}return!!e&&s},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return b.clone(this._previousAttributes)},fetch:function(i){i=b.extend({parse:!0},i);var n=this,s=i.success;return i.success=function(t){var e=i.parse?n.parse(t,i):t;if(!n.set(e,i))return!1;s&&s.call(i.context,n,t,i),n.trigger("sync",n,t,i)},B(this,i),this.sync("read",this,i)},save:function(t,e,i){var n;null==t||"object"==typeof t?(n=t,i=e):(n={})[t]=e;var s=(i=b.extend({validate:!0,parse:!0},i)).wait;if(n&&!s){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;var r=this,o=i.success,h=this.attributes;i.success=function(t){r.attributes=h;var e=i.parse?r.parse(t,i):t;if((e=s?b.extend({},n,e):e)&&!r.set(e,i))return!1;o&&o.call(i.context,r,t,i),r.trigger("sync",r,t,i)},B(this,i),n&&s&&(this.attributes=b.extend({},h,n));e=this.isNew()?"create":i.patch?"patch":"update";"patch"!=e||i.attrs||(i.attrs=n);e=this.sync(e,this,i);return this.attributes=h,e},destroy:function(e){e=e?b.clone(e):{};function i(){n.stopListening(),n.trigger("destroy",n,n.collection,e)}var n=this,s=e.success,r=e.wait,t=!(e.success=function(t){r&&i(),s&&s.call(e.context,n,t,e),n.isNew()||n.trigger("sync",n,t,e)});return this.isNew()?b.defer(e.success):(B(this,e),t=this.sync("delete",this,e)),r||i(),t},url:function(){var t=b.result(this,"urlRoot")||b.result(this.collection,"url")||F();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},b.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=b.extend({},this.attributes,t);t=this.validationError=this.validate(t,e)||null;return!t||(this.trigger("invalid",this,t,b.extend(e,{validationError:t})),!1)}});function x(t,e,i){i=Math.min(Math.max(i,0),t.length);for(var n=Array(t.length-i),s=e.length,r=0;r<n.length;r++)n[r]=t[r+i];for(r=0;r<s;r++)t[r+i]=e[r];for(r=0;r<n.length;r++)t[r+s+i]=n[r]}var m=h.Collection=function(t,e){e=e||{},this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,b.extend({silent:!0},e))},w={add:!0,remove:!0,merge:!0},_={add:!0,remove:!1};b.extend(m.prototype,n,{model:v,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return h.sync.apply(this,arguments)},add:function(t,e){return this.set(t,b.extend({merge:!1},e,_))},remove:function(t,e){e=b.extend({},e);var i=!b.isArray(t);t=i?[t]:t.slice();t=this._removeModels(t,e);return!e.silent&&t.length&&(e.changes={added:[],merged:[],removed:t},this.trigger("update",this,e)),i?t[0]:t},set:function(t,e){if(null!=t){(e=b.extend({},w,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var i=!b.isArray(t);t=i?[t]:t.slice();var n=e.at;(n=(n=null!=n?+n:n)>this.length?this.length:n)<0&&(n+=this.length+1);for(var s=[],r=[],o=[],h=[],a={},u=e.add,c=e.merge,l=e.remove,d=!1,f=this.comparator&&null==n&&!1!==e.sort,p=b.isString(this.comparator)?this.comparator:null,g=0;g<t.length;g++){var v,m=t[g],_=this.get(m);_?(c&&m!==_&&(v=this._isModel(m)?m.attributes:m,e.parse&&(v=_.parse(v,e)),_.set(v,e),o.push(_),f&&!d&&(d=_.hasChanged(p))),a[_.cid]||(a[_.cid]=!0,s.push(_)),t[g]=_):u&&(m=t[g]=this._prepareModel(m,e))&&(r.push(m),this._addReference(m,e),a[m.cid]=!0,s.push(m))}if(l){for(g=0;g<this.length;g++)a[(m=this.models[g]).cid]||h.push(m);h.length&&this._removeModels(h,e)}var y=!1;if(s.length&&(!f&&u&&l)?(y=this.length!==s.length||b.some(this.models,function(t,e){return t!==s[e]}),this.models.length=0,x(this.models,s,0),this.length=this.models.length):r.length&&(f&&(d=!0),x(this.models,r,null==n?this.length:n),this.length=this.models.length),d&&this.sort({silent:!0}),!e.silent){for(g=0;g<r.length;g++)null!=n&&(e.index=n+g),(m=r[g]).trigger("add",m,this,e);(d||y)&&this.trigger("sort",this,e),(r.length||h.length||o.length)&&(e.changes={added:r,removed:h,merged:o},this.trigger("update",this,e))}return i?t[0]:t}},reset:function(t,e){e=e?b.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,b.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,b.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,b.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return o.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t=t||{};var i=e.length;return b.isFunction(e)&&(e=e.bind(this)),1===i||b.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(i){var n=(i=b.extend({parse:!0},i)).success,s=this;return i.success=function(t){var e=i.reset?"reset":"set";s[e](t,i),n&&n.call(i.context,s,t,i),s.trigger("sync",s,t,i)},B(this,i),this.sync("read",this,i)},create:function(t,e){var n=(e=e?b.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;n||this.add(t,e);var s=this,r=e.success;return e.success=function(t,e,i){n&&s.add(t,i),r&&r.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},values:function(){return new E(this,k)},keys:function(){return new E(this,I)},entries:function(){return new E(this,S)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;t=new((e=e?b.clone(e):{}).collection=this).model(t,e);return t.validationError?(this.trigger("invalid",this,t.validationError,e),!1):t},_removeModels:function(t,e){for(var i=[],n=0;n<t.length;n++){var s,r,o=this.get(t[n]);o&&(s=this.indexOf(o),this.models.splice(s,1),this.length--,delete this._byId[o.cid],null!=(r=this.modelId(o.attributes))&&delete this._byId[r],e.silent||(e.index=s,o.trigger("remove",o,this,e)),i.push(o),this._removeReference(o,e))}return i},_isModel:function(t){return t instanceof v},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if(e){if(("add"===t||"remove"===t)&&i!==this)return;var s,r;"destroy"===t&&this.remove(e,n),"change"!==t||(s=this.modelId(e.previousAttributes()))!==(r=this.modelId(e.attributes))&&(null!=s&&delete this._byId[s],null!=r&&(this._byId[r]=e))}this.trigger.apply(this,arguments)}});var y="function"==typeof Symbol&&Symbol.iterator;y&&(m.prototype[y]=m.prototype.values);var E=function(t,e){this._collection=t,this._kind=e,this._index=0},k=1,I=2,S=3;y&&(E.prototype[y]=function(){return this}),E.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t,e=this._collection.at(this._index);return this._index++,{value:this._kind===k?e:(t=this._collection.modelId(e.attributes),this._kind===I?t:[t,e]),done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var e=h.View=function(t){this.cid=b.uniqueId("view"),this.preinitialize.apply(this,arguments),b.extend(this,b.pick(t,P)),this._ensureElement(),this.initialize.apply(this,arguments)},T=/^(\S+)\s*(.*)$/,P=["model","collection","el","id","attributes","className","tagName","events"];b.extend(e.prototype,n,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof h.$?t:h.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(!(t=t||b.result(this,"events")))return this;for(var e in this.undelegateEvents(),t){var i=t[e];(i=!b.isFunction(i)?this[i]:i)&&(e=e.match(T),this.delegate(e[1],e[2],i.bind(this)))}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){var t;this.el?this.setElement(b.result(this,"el")):(t=b.extend({},b.result(this,"attributes")),this.id&&(t.id=b.result(this,"id")),this.className&&(t.class=b.result(this,"className")),this.setElement(this._createElement(b.result(this,"tagName"))),this._setAttributes(t))},_setAttributes:function(t){this.$el.attr(t)}});function H(i,n,t,s){b.each(t,function(t,e){n[e]&&(i.prototype[e]=function(n,t,s,r){switch(t){case 1:return function(){return n[s](this[r])};case 2:return function(t){return n[s](this[r],t)};case 3:return function(t,e){return n[s](this[r],$(t,this),e)};case 4:return function(t,e,i){return n[s](this[r],$(t,this),e,i)};default:return function(){var t=o.call(arguments);return t.unshift(this[r]),n[s].apply(n,t)}}}(n,t,e,s))})}var $=function(e,t){return b.isFunction(e)?e:b.isObject(e)&&!t._isModel(e)?A(e):b.isString(e)?function(t){return t.get(e)}:e},A=function(t){var e=b.matches(t);return function(t){return e(t.attributes)}};b.each([[m,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[v,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],function(t){var i=t[0],e=t[1],n=t[2];i.mixin=function(t){var e=b.reduce(b.functions(t),function(t,e){return t[e]=0,t},{});H(i,t,e,n)},H(i,b,e,n)}),h.sync=function(t,e,n){var i=C[t];b.defaults(n=n||{},{emulateHTTP:h.emulateHTTP,emulateJSON:h.emulateJSON});var s,r={type:i,dataType:"json"};n.url||(r.url=b.result(e,"url")||F()),null!=n.data||!e||"create"!==t&&"update"!==t&&"patch"!==t||(r.contentType="application/json",r.data=JSON.stringify(n.attrs||e.toJSON(n))),n.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),!n.emulateHTTP||"PUT"!==i&&"DELETE"!==i&&"PATCH"!==i||(r.type="POST",n.emulateJSON&&(r.data._method=i),s=n.beforeSend,n.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",i),s)return s.apply(this,arguments)}),"GET"===r.type||n.emulateJSON||(r.processData=!1);var o=n.error;n.error=function(t,e,i){n.textStatus=e,n.errorThrown=i,o&&o.call(n.context,t,e,i)};r=n.xhr=h.ajax(b.extend(r,n));return e.trigger("request",e,r,n),r};var C={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};h.ajax=function(){return h.$.ajax.apply(h.$,arguments)};var y=h.Router=function(t){t=t||{},this.preinitialize.apply(this,arguments),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},R=/\((.*?)\)/g,M=/(\(\?)?:\w+/g,N=/\*\w+/g,j=/[\-{}\[\]+?.,\\\^$|#\s]/g;b.extend(y.prototype,n,{preinitialize:function(){},initialize:function(){},route:function(e,i,n){b.isRegExp(e)||(e=this._routeToRegExp(e)),b.isFunction(i)&&(n=i,i=""),n=n||this[i];var s=this;return h.history.route(e,function(t){t=s._extractParameters(e,t);!1!==s.execute(n,t,i)&&(s.trigger.apply(s,["route:"+i].concat(t)),s.trigger("route",i,t),h.history.trigger("route",s,i,t))}),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,e){return h.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=b.result(this,"routes");for(var t,e=b.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(j,"\\$&").replace(R,"(?:$1)?").replace(M,function(t,e){return e?t:"([^/?]+)"}).replace(N,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return b.map(i,function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null})}});var O=h.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},U=/^[#\/]|\s+$/g,z=/^\/+|\/+$/g,q=/#.*$/;O.started=!1,b.extend(O.prototype,n,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){t=(t||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return(t=null==t?this._usePushState||!this._wantsHashChange?this.getPath():this.getHash():t).replace(U,"")},start:function(t){if(O.started)throw new Error("Backbone.history has already been started");if(O.started=!0,this.options=b.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(z,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}this._hasHashChange||!this._wantsHashChange||this._usePushState||(this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1,(e=(e=document.body).insertBefore(this.iframe,e.firstChild).contentWindow).document.open(),e.document.close(),e.location.hash="#"+this.fragment);var e=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?e("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),O.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if((e=e===this.fragment&&this.iframe?this.getHash(this.iframe.contentWindow):e)===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),b.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(t,e){if(!O.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root,n=(i=""===t||"?"===t.charAt(0)?i.slice(0,-1)||"/":i)+t;t=t.replace(q,"");i=this.decodeFragment(t);if(this.fragment!==i){if(this.fragment=i,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)&&(n=this.iframe.contentWindow,e.replace||(n.document.open(),n.document.close()),this._updateHash(n.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){i?(i=t.href.replace(/(javascript:|#).*$/,""),t.replace(i+"#"+e)):t.hash="#"+e}}),h.history=new O;v.extend=m.extend=y.extend=e.extend=O.extend=function(t,e){var i=this,n=t&&b.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)};return b.extend(n,i,e),n.prototype=b.create(i.prototype,t),(n.prototype.constructor=n).__super__=i.prototype,n};var F=function(){throw new Error('A "url" property or function must be specified')},B=function(e,i){var n=i.error;i.error=function(t){n&&n.call(i.context,e,t,i),e.trigger("error",e,t,i)}};return h});;
'use strict';

/**
 * Get cookie value by name.
 *
 * @param {string} name
 * @returns {string}
 */
function upxGetCookie(name) {
    var value = '; ' + document.cookie;
    var parts = value.split('; ' + name + '=');
    if (parts.length === 2) return parts.pop().split(';').shift();
}

/**
 * Get current device view.
 *
 * @returns {string}
 */
function upxGetDeviceView() {
    if (upxIsMobileView()) {
        return 'mobile';
    } else if (window.innerWidth <= 960) {
        return 'tablet';
    }
    return 'desktop';
}

/**
 * Get window Y scroll position.
 *
 * @returns {number}
 */
function upxGetWinScrollTop() {
    return (window.pageYOffset || document.scrollTop) - (document.clientTop || 0);
}

/**
 * Get window viewport height.
 *
 * @returns {number}
 */
function upxGetWinH() {
    return (window.innerHeight || document.documentElement.clientHeight);
}

/**
 * Detect if user is almost at the bottom of the page.
 *
 * @returns {boolean}
 */
function upxIsCloseToBottom(indent) {

    if (typeof indent === 'undefined') {
        indent = 0;
    }

    var viewportHeight = window.innerHeight;
    var scrollPosition = window.pageYOffset;
    var bodyHeight = document.body.offsetHeight;
    var bottomDistance = Math.max(bodyHeight - (scrollPosition + viewportHeight), 0);

    // Get the maximum allowed distance from bottom.
    // Let's make it half size of the screen size unless it's smaller than indent.
    var maxIndent = Math.min(indent, viewportHeight / 2);

    return bottomDistance <= maxIndent;
}

/**
 * Detect if user is almost at the bottom of the element or passed it.
 *
 * @returns {boolean}
 */
function upxIsCloseToEl(el, indent) {

    if (typeof indent === 'undefined') {
        indent = 0;
    }

    var viewportHeight = window.innerHeight;
    var scrollPosition = window.pageYOffset;
    var distance = Math.abs(jQuery(el).offset().top - (scrollPosition + viewportHeight));

    return distance <= indent;
}

/**
 * Check if HTML Element is in a view port.
 *
 * @param {HTMLElement} el
 * @param {Number} minVisibleH
 *
 * @returns {boolean}
 */
function upxIsInViewport(el, minVisibleH) {

    var bounding = el.getBoundingClientRect();
    var winH = upxGetWinH();

    if (typeof minVisibleH === 'undefined') {
        minVisibleH = winH / 2;
    }

    return bounding.bottom - minVisibleH > 0 && bounding.top < winH - minVisibleH;

}

/**
 * Detect if current view is mobile one.
 *
 * @returns {boolean}
 */
function upxIsMobileView() {
    return window.innerWidth <= 640;
};
'use strict';

/**
 * Global javascripts used on all pages.
 */

var UPX = {};

// Extend backbone event.
_.extend(UPX, Backbone.Events);

(function ($) {

    /**
     * Statistics.
     */
    $(document).ready(function () {

        // Track page view.
        var track = function () {
            UPX.urlTracker.track(window.location.href, document.title);
        };
        if (UPX.urlTracker) {
            track();
        } else {
            UPX.bind('urlTrackerReady', track);
        }

        // Init account menu.
        initMenu();

        // Init CCPA.
        initCcpa();
    });

    /**
     * Refresh social widgets.
     */
    $(document.body).on('post-load', function () {

        // Twitter widgets.
        if (window.twttr && twttr.widgets) {
            twttr.widgets.load();
        }
        // Instagram widgets.
        if (window.instgrm && instgrm.Embeds) {
            instgrm.Embeds.process();
        }
    });

    /**
     * Fade Lazy Loaded Jetpack images.
     */
    $(document.body).on('jetpack-lazy-loaded-image', function (e) {
        var img = e.target;
        img.onload = function () {
            img.classList.add('jetpack-lazy-image--loaded')
        }
    });

    $(document).ready(function () {
        $('.upx-click-url').each(function () {
            var url = $(this).data('url');
            if (url) {
                $(this).find('a').each(function () {
                    $(this).attr('href', url);
                });
            }
        });
    });

    /**
     * Search Form focus.
     *
     * @type {Element}
     */
    var searchform = document.querySelector('.menu-search .search-form');
    if (searchform) {
        var searchfield = searchform.getElementsByTagName('input')[0];
        searchform.addEventListener('mouseover', function () {
            searchfield.focus();
        });
    }

    /**
     * Display consent message to CA users.
     */
    function initCcpa() {
        // The popup is coming soon.
    }

    /**
     * Init auth links in menu.
     */
    function initMenu() {

        if (UPX.sso) {
            onSsoReady();
        } else {
            UPX.bind('ssoReady', onSsoReady());
        }

        // Add event listeners for auth links.
        $('#page').on('click', '.upx-sign-in', function (e) {
            e.preventDefault();
            UPX.sso.startSignin();
            return false;
        }).on('click', '.upx-sign-out', function (e) {
            e.preventDefault();
            UPX.sso.startSignout();
            return false;
        }).on('click', '.upx-sign-up', function (e) {
            e.preventDefault();
            UPX.sso.startSignup();
            return false;
        });
    }

    /**
     * Once SSO is ready.
     */
    function onSsoReady() {
        UPX.sso.bind('userLogin', updateAuthLinks);
        updateAuthLinks();
    }

    /**
     * Update auth links depending on user state.
     */
    function updateAuthLinks() {
        if (UPX.sso.getUser()) {
            $('body').addClass('upx-logged-in');
        } else {
            $('body').removeClass('upx-logged-in');
        }
    }

})(jQuery);
;
'use strict';

UPX.bind('adServiceReady', function () {
    UPX.adService.setAdTag(new FreestarTag());
});

/**
 * googletag replacement class.
 *
 * @constructor
 */
function FreestarTag() {

    var me = this;
    this.cmd = [];
    this.pubadsObj = new FreestarPubads();

    freestar.initCallback = function () {
        for (var i in me.cmd) {
            freestar.queue.push(me.cmd[i]);
        }
        me.cmd = freestar.queue;
    };
}

/**
 * @param path
 * @param sizes
 * @param elId
 * @return {FreestarSlot}
 */
FreestarTag.prototype.defineSlot = function (path, sizes, elId) {
    try {
        return new FreestarSlot(path, elId);
    } catch (e) {
        return null;
    }
};

/**
 * Destroy ad slots.
 *
 * @param slots
 */
FreestarTag.prototype.destroySlots = function (slots) {
    freestar.deleteAdSlots(slots);
};

/**
 * @return {FreestarPubads}
 */
FreestarTag.prototype.pubads = function () {
    return this.pubadsObj;
};

/////////////////////////////////////////////////////////////

/**
 * googletag.PubAdsService replacement.
 *
 * @constructor
 */
function FreestarPubads() {

}

/**
 *
 * @param {Object} event
 * @param {function} callback
 */
FreestarPubads.prototype.addEventListener = function (event, callback) {
    googletag.pubads().addEventListener(event, callback);
};

/**
 * Render ads on a page.
 *
 * @param slots
 */
FreestarPubads.prototype.refresh = function (slots) {

    if (!slots || !slots.length) {
        return;
    }

    var channelAdSlots = {};
    for (var i = 0; i < slots.length; i++) {
        var slot = slots[i];
        if (!slot.placementName || !slot.channel) {
            continue;
        }

        if (!channelAdSlots[slot.channel]) {
            channelAdSlots[slot.channel] = [];
        }

        channelAdSlots[slot.channel].push({
            placementName: slot.placementName,
            slotId: slot.elId,
            targeting: slot.targeting
        });
    }

    for (var channel in channelAdSlots) {
        freestar.newAdSlots(channelAdSlots[channel], channel);
    }
};

/////////////////////////////////////////////////////////////

/**
 * googletag.Slot replacement class.
 *
 * @param path
 * @param elId
 * @constructor
 */
function FreestarSlot(path, elId) {

    this.elId = elId;
    this.targeting = {};

    // Placement name.
    var el = document.getElementById(elId);
    var slotName = el.getAttribute('data-ad-unit');

    // Detect placement.
    var placement = this.map[slotName];
    this.placementName = typeof placement === 'object' ? placement[upxGetDeviceView()] : placement;

    // Channel name.
    var parts = path.split('/');
    this.channel = parts.slice(3, -1).join('/');
}

/**
 * Uproxx ad slots => Freestar ad placements
 *
 * @type {{leaderboard: string, footer_article: string, sw_interstitial: string, native: string, top_rec: string, bottom_rec: string, adhesion: string, video: string, footer_landing: string}}
 */
FreestarSlot.prototype.map = {
    'adhesion': 'uproxx_320x50_Adhesion',
    'bottom_rec': 'uproxx_300x250_300x600_160x600_RightRail2',
    'footer_article': 'uproxx_300x250_320x50_ArticleInContent',
    'footer_landing': 'uproxx_728x90_970x90_970x250_320x50_300x250_LandingInContent',
    'leaderboard': {
        'mobile': 'uproxx_728x90_970x90_970x250_320x50_ATF_mobile',
        'desktop': 'uproxx_728x90_970x90_970x250_320x50_ATF',
        'tablet': 'uproxx_728x90_970x90_970x250_320x50_ATF'
    },
    'native': 'uproxx_native',
    'sw_interstitial': 'uproxx_intersitial',
    'top_rec': 'uproxx_300x250_300x600_160x600_RightRail1',
    'video': 'uproxx_video'
};

/**
 * @param service
 */
FreestarSlot.prototype.addService = function (service) {

};

/**
 * @returns {*}
 */
FreestarSlot.prototype.getSlotElementId = function () {
    return this.elId;
}

/**
 * @param key
 * @param value
 */
FreestarSlot.prototype.setTargeting = function (key, value) {
    this.targeting[key] = value;
};;
'use strict';

/**
 * Advertisement Lazy Load.
 */
UPX.bind('adServiceReady', function () {

    window.addEventListener('scroll', onScroll);

    /**
     * See if ads is close to the viewport.
     */
    function onScroll() {
        var ads = document.querySelectorAll('.upx-ad-lazy');

        if (!ads && !ads.length) {
            return;
        }

        var numAffected = 0;
        var indent = upxGetWinH() / 2;

        for (var i = 0; i < ads.length; i++) {
            var el = ads[i];
            if (el.offsetParent && upxIsCloseToEl(el, indent)) {
                el.classList.remove('upx-ad-lazy');
                el.classList.add('upx-ad-placeholder');
                numAffected++;
            }
        }

        if (numAffected) {
            UPX.adService.render(null);
        }
    }

});
;
'use strict';

/**
 * Ad Unit Model.
 *
 * @param {Element} el
 * @param {number} id
 * @param {Object} context
 *
 * @constructor
 */
function UpxAdUnit(el, id, context) {

    // Validate ad unit HTML element and its attributes.

    if (!el) {
        throw 'Empty Ad Placeholder';
    }

    var unitId = el.getAttribute('data-ad-unit');
    if (!unitId) {
        throw 'Ad Unit Name is missing';
    }

    var spec = UPX.adService.getAdUnitSpec(unitId);
    if (!spec) {
        throw 'Ad Unit "' + unitId + '" does not exist';
    }

    // Check the screens.
    this.screens = [];
    if (el.getAttribute('data-ad-screens')) {
        this.screens = el.getAttribute('data-ad-screens').split(',');
    }

    // Modify HTML element.
    var classes = el.getAttribute('class').split(' ');
    classes.push('upx-ad-unit');
    classes.push(spec.slotName);

    el.id = 'upxAd' + id;
    el.className = classes.filter(function (value, index, self) {
        return self.indexOf(value) === index && value !== 'upx-ad-placeholder';
    }).join(' ');

    // Save input params.
    this.context = context;
    this.el = el;
    this.spec = spec;
}

/**
 * Check if ad slot can be rendered on a page.
 *
 * @param {String} screen
 * @returns {boolean}
 */
UpxAdUnit.prototype.canRender = function (screen) {
    if (this.screens.length === 0) {
        return true;
    }
    return this.screens.indexOf(screen) !== -1;
};

/**
 * Get DFP ad slot.
 *
 * @param {Object} adTag
 * @param {String} device
 * @returns {Object}
 */
UpxAdUnit.prototype.getAdSlot = function (adTag, device) {

    // Generate ad unit path.
    var adUnitPath = this.context.adsPath + '/' + this.spec.slotName;

    // If there are no sizes for the device - do not generate slot.
    var sizes = this.spec.sizes[device];
    if (!sizes) {
        return null;
    }

    // Define slot.
    var slot = adTag.defineSlot(adUnitPath, sizes, this.el.id);
    if (!slot) {
        return null;
    }

    // Set targeting.
    var targeting = this.context.targeting || {};
    targeting.screen = device;
    targeting.domain = this.getCurrentDomain();

    for (var key in this.context.targeting) {
        slot.setTargeting(key, this.context.targeting[key]);
    }

    // For adops team to debug.
    console.groupCollapsed('%cUPX AdSlot ' + adUnitPath, 'background-color:#4c87f1;color: #fff;padding:5px');
    console.log('Sizes', sizes);
    console.log('Targeting', targeting);
    console.log('Element', this.el);
    console.groupEnd();

    // Return slot.
    return slot;
};

/**
 * Get verified current domain name.
 *
 * @return {string}
 */
UpxAdUnit.prototype.getCurrentDomain = function () {
    var domain = window.location.hostname;
    var reg = /^([a-z_\-]*\.)?(uproxx\.com|go-vip\.net)$/i;
    if (!reg.test(domain)) {
        domain = '';
    }
    return domain;
};

/**
 * Ad Unit Type getter.
 *
 * @returns {string}
 */
UpxAdUnit.prototype.getType = function () {
    return this.spec.type;
};
;
'use strict';

(function (_, $, adTag, settings) {

    /**
     * @constructor
     */
    function UpxAdService(settings) {

        // Save settings and state.
        this.adTag = adTag;
        this.adUnits = [];
        this.canRender = false;
        this.defaultContext = {};
        this.lastUnitId = 1;
        this.preBidders = [];
        this.renderQueue = [];
        this.settings = settings;
        this.viewType = upxGetDeviceView();

        // Track window width changes.
        var me = this;
        window.addEventListener('resize', function (event) {
            me.onWinResize(event);
        });

        // Track slot render events.
        adTag.cmd.push(function () {
            adTag.pubads().addEventListener('slotRenderEnded', function (event) {
                me.trigger('slotRenderEnded', event);
                me.trackAdSize(event);
            });
        });

        this.initConsent();
    }

    /**
     * Display ads after consent is initialized.
     */
    UpxAdService.prototype.initConsent = function () {
        var me = this;
        var consentInt;
        var allowRenderAds = function () {
            clearInterval(consentInt);
            consentInt = 0;
            me.canRender = true;
            me.renderQueuedSlots();
        };

        consentInt = setInterval(function () {
            if (typeof __tcfapi === 'undefined') {
                return;
            }
            clearInterval(consentInt);

            __tcfapi('addEventListener', 2, function (tcData, success) {
                if (success) {
                    if (!tcData.gdprApplies) {
                        allowRenderAds();
                    } else if (tcData.eventStatus === 'tcloaded' || tcData.eventStatus === 'useractioncomplete') {
                        __tcfapi('getTCData', 2, function (tcData, success) {
                            // Google Advertising Products #ID 755
                            // Publisher First, Inc. #ID 850
                            if (success
                                && tcData.vendor.consents[755] && tcData.vendor.consents[850]
                                && tcData.vendor.legitimateInterests[755] && tcData.vendor.legitimateInterests[850]
                            ) {
                                allowRenderAds();
                            }
                        });
                    }
                }
            });
        }, 50);
    };

    /**
     * Add ad pre-bidder.
     *
     * @param {Object} preBidder
     */
    UpxAdService.prototype.addPreBidder = function (preBidder) {
        this.preBidders.push(preBidder);
    };

    /**
     * Add ad unit to render queue.
     *
     * @param {UpxAdUnit} unit
     */
    UpxAdService.prototype.addToRenderQueue = function (unit) {
        var slot = unit.getAdSlot(this.adTag, this.viewType);
        if (slot) {
            slot.addService(this.adTag.pubads());
            this.renderQueue.push(slot);
        }
    };

    /**
     * Hide empty ads.
     *
     * @param event
     */
    UpxAdService.prototype.trackAdSize = function (event) {
        var div = document.getElementById(event.slot.getSlotElementId());
        if (div) {
            if (event.isEmpty) {
                div.classList.add('upx-hidden');
            } else {
                var me = this;
                var numTries = 0;
                var intRef = setInterval(function () {
                    if (!div || !me.checkIfEmptyAd(div) || ++numTries >= 20) {
                        clearInterval(intRef);
                    }
                }, 1000);
            }
        }
    };

    /**
     * Hide empty ads.
     *
     * @param div
     * @param inRef
     * @return boolean True - if ad was empty.
     */
    UpxAdService.prototype.checkIfEmptyAd = function (div) {
        if (!div) {
            return true;
        }
        div.classList.remove('upx-hidden');

        var el = div.querySelector('div:first-of-type');
        if (!el || el.clientWidth < 100 || el.clientHeight < 50) {
            div.classList.add('upx-hidden');
            return true;
        }

        return false;
    };

    /**
     * Get ad tag.
     */
    UpxAdService.prototype.getAdTag = function () {
        return this.adTag;
    };

    /**
     * Get ad unit specification.
     */
    UpxAdService.prototype.getAdUnitSpec = function (name) {
        return this.settings.adUnits[name];
    };

    /**
     * Get service settings.
     */
    UpxAdService.prototype.getSettings = function () {
        return this.settings;
    };

    /**
     * Check if view has been changed.
     */
    UpxAdService.prototype.onWinResize = function () {
        var viewType = upxGetDeviceView();
        if (viewType !== this.viewType) {
            this.viewType = viewType;
            this.refreshAds();
        }
    };

    /**
     * Re-render all advertisements on a page.
     */
    UpxAdService.prototype.refreshAds = function () {

        // Destroy all previous ads on a page.
        this.adTag.destroySlots();

        // Reset hidden empty ads.
        document.querySelectorAll('.upx-ad-unit.upx-hidden').forEach(function (el) {
            el.classList.remove('upx-hidden');
        });

        // Queue ad units to be re-rendered.
        var screen = upxGetDeviceView();
        for (var i = 0; i < this.adUnits.length; i++) {
            if (this.adUnits[i].canRender(screen)) {
                this.addToRenderQueue(this.adUnits[i]);
            }
        }

        // Render queued.
        this.renderQueuedSlots();
    };

    /**
     * Render not processed ads on a page.
     *
     * @param {Object} context
     */
    UpxAdService.prototype.render = function (context) {

        var me = this;
        var screen = upxGetDeviceView();

        if (!context) {
            context = me.defaultContext;
        }

        // Find all not processed ad placeholders.
        var placeholders = document.querySelectorAll('div.upx-ad-placeholder');
        var elements = [];
        for (var i = 0; i < placeholders.length; i++) {

            // Process units only one time.
            var el = placeholders[i];
            if (el.classList.contains('upx-initialized')) {
                continue;
            }
            el.classList.add('upx-initialized');
            elements.push(el);
        }

        // Render all queued as units.
        this.adTag.cmd.push(function () {
            for (var i = 0; i < elements.length; i++) {

                // Create new ad unit.
                var unit = new UpxAdUnit(elements[i], me.lastUnitId++, context);

                // Interstitial ads should be skipped from refreshing during window resize.
                if (unit.getType() !== 'interstitial') {
                    me.adUnits.push(unit);
                }

                // Queue render of new ad unit.
                if (unit.canRender(screen)) {
                    me.addToRenderQueue(unit);
                }
            }

            me.renderQueuedSlots();
        });
    };

    /**
     * Render queued dfp ad slots.
     */
    UpxAdService.prototype.renderQueuedSlots = function () {

        // Check if can render.
        if (!this.canRender) {
            return;
        }

        // Check if there are slots for render.
        if (!this.renderQueue.length) {
            return;
        }

        // Reset queue.
        var slots = this.renderQueue;
        this.renderQueue = [];

        // Run all pre-bidders.
        var promises = [];
        for (var i = 0; i < this.preBidders.length; i++) {
            promises.push(this.preBidders[i].execute(this.adTag, slots));
        }

        // Wait for pre-bidders to finish their work.
        var me = this;
        Promise.all(promises).then(function () {
            me.adTag.pubads().refresh(slots);
        });
    };

    /**
     * Set ad tag.
     *
     * @param {Object} adTag
     */
    UpxAdService.prototype.setAdTag = function (adTag) {
        this.adTag = adTag;
    };

    /**
     * Set global context.
     *
     * @param context
     */
    UpxAdService.prototype.setContext = function (context) {
        this.defaultContext = context;
    };

    /**
     * Get global context.
     *
     * @param context
     */
    UpxAdService.prototype.getContext = function () {
        return this.defaultContext;
    };

    // Extend backbone event.
    _.extend(UpxAdService.prototype, Backbone.Events);
    UpxAdService.constructor = UpxAdService;

    // Create instance and render all ads on a page.
    UPX.adService = new UpxAdService(settings);
    UPX.trigger('adServiceReady');

    // Initial render.
    UPX.adService.setContext(settings.pageContext);
    $(document).ready(function () {
        UPX.adService.render(settings.pageContext);
    });
})(_, jQuery, googletag, upxAdSettings);
;
'use strict';

/**
 * Object to change browser address bar.
 */

/**
 * @constructor
 */
function UpxUrlUpdater() {
    this.items = [];
    this.currentItem = null; // Current item in viewport

    var me = this;
    window.addEventListener('scroll', function (e) {
        me.onWinScroll(e);
    });
}

/**
 * Add HTML Element to the list.
 *
 * @param {HTMLElement|Element} el
 * @param {string} url
 * @param {string} title
 * @param {Object} meta
 */
UpxUrlUpdater.prototype.add = function (el, url, title, meta) {
    this.items.push({
        el: el,
        title: title,
        url: url,
        meta: meta
    });
};

/**
 * Track the page views and update address bar if needed.
 */
UpxUrlUpdater.prototype.onWinScroll = function () {
    for (var i = 0; i < this.items.length; i++) {
        var data = this.items[i];
        if (upxIsInViewport(data.el)) {

            if (this.currentItem !== data) {

                var eventData = {
                    'newItem': data,
                    'prevItem': this.currentItem
                };

                this.currentItem = data;
                window.history.replaceState(null, data.title, data.url);
                document.title = data.title;

                this.trigger('update', eventData);
            }
            return;
        }
    }
};

// Extend backbone event.
_.extend(UpxUrlUpdater.prototype, Backbone.Events);

// Create service.
UPX.urlUpdater = new UpxUrlUpdater();
;
'use strict';

/**
 * Adhesion unit module.
 */
(function () {

    // Currently active post on a page.
    var currentPostId;

    // All active adhesion units on a page.
    var units = {};

    // Events.
    if (UPX.singleInfiniteScroll) {
        singleInfiniteReady();
    } else {
        UPX.bind('singleInfiniteReady', singleInfiniteReady);
    }

    UPX.adService.bind('slotRenderEnded', slotRenderEnded);
    UPX.urlUpdater.bind('update', urlUpdate);

    /**
     * Register adhesion unit for the specific post.
     *
     * @param {Number} postId
     * @param {HTMLElement} el
     */
    function addUnit(postId, el) {
        units[postId] = el;
        el.getElementsByClassName('upx-adhesion-close')[0].addEventListener('click', function (e) {
            removeUnit(postId);
            e.preventDefault()
        });

        if (currentPostId === postId) {
            showUnit(postId);
        }
    }

    /**
     * Remove adhesion unit.
     *
     * @param postId
     */
    function removeUnit(postId) {

        if (!units[postId]) {
            return;
        }

        units[postId].classList.remove('visible');
        setTimeout(function () {
            if (units[postId]) {
                if (units[postId].parentNode) {
                    units[postId].parentNode.removeChild(units[postId]);
                }
                delete units[postId];
            }
        }, 400);
    }

    /**
     * Show adhesion unit.
     *
     * @param postId
     */
    function showUnit(postId) {

        // Hide previous unit.
        if (currentPostId && currentPostId !== postId) {
            var prevUnit = units[currentPostId];
            if (prevUnit) {
                prevUnit.classList.remove('visible');
            }
        }

        // Show new unit.
        if (postId) {
            var newUnit = units[postId];
            if (newUnit) {
                newUnit.classList.add('visible');
            }
        }
    }

    /**
     * Once single infinite scroll is ready.
     */
    function singleInfiniteReady() {
        currentPostId = UPX.singleInfiniteScroll.currentPost.id;
    }

    /**
     * Once ad slot is rendered on a page.
     *
     * @param e
     */
    function slotRenderEnded(e) {

        // Check if ad is not empty.
        if (!e || e.isEmpty) {
            return;
        }

        // Check if ad is adhesion unit.
        var el = document.getElementById(e.slot.getSlotElementId());
        if (!el || el.getAttribute('data-ad-unit') !== 'adhesion') {
            return;
        }

        // Save element.
        addUnit(parseInt(el.parentElement.getAttribute('data-post-id')), el.parentElement);
    }

    /**
     * Once address bar URL has been changed.
     *
     * @param {Object} eventData
     */
    function urlUpdate(eventData) {

        // Verify event.
        if (!eventData || !eventData.newItem) {
            return;
        }

        // Check if post changed.
        var newCurrentPostId = eventData.newItem.meta.id;
        if (newCurrentPostId === currentPostId) {
            return;
        }

        // Show unit.
        showUnit(newCurrentPostId);
        currentPostId = newCurrentPostId;
    }
})();
;
