(window.webpackJsonp_spotim_registration=window.webpackJsonp_spotim_registration||[]).push([[4],{24:function(t,e,n){"use strict";n.d(e,"n",(function(){return a})),n.d(e,"h",(function(){return c})),n.d(e,"m",(function(){return s})),n.d(e,"i",(function(){return i})),n.d(e,"j",(function(){return u})),n.d(e,"o",(function(){return d})),n.d(e,"k",(function(){return f})),n.d(e,"l",(function(){return p})),n.d(e,"e",(function(){return l})),n.d(e,"c",(function(){return g})),n.d(e,"g",(function(){return O})),n.d(e,"b",(function(){return b})),n.d(e,"f",(function(){return w})),n.d(e,"a",(function(){return v})),n.d(e,"d",(function(){return h}));var r=n(7),o=n.n(r),a=o.a.get("init_data.config.id"),c=o.a.get("init_data.config.brand_color"),s=o.a.get("init_data.config.name"),i=o.a.get("init_data.config.connect_networks"),u=o.a.get("init_data.config.ltr")?"ltr":"rtl",d=o.a.get("tenant_config.registration.use_new_sso_api",!1),f=2===o.a.get("tenant_config.authentication.version",1),p=o.a.get("tenant_config.authentication.real_user_mode",!1),l="x-spotim-page-view-id",g="x-spotim-device-uuid",O="x-spotim-token",b="x-openweb-token",w="x-spotim-spotid",v="x-access-token",h="x-spotim-device-v2"},25:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return o}));function r(t){var e=t.accessToken,n=t.openWebAccessToken;e&&localStorage.setItem("SPOTIM_ACCESS_TOKEN",e),n&&localStorage.setItem("OPENWEB_ACCESS_TOKEN",n)}function o(){return{accessToken:localStorage.getItem("SPOTIM_ACCESS_TOKEN"),openWebAccessToken:localStorage.getItem("OPENWEB_ACCESS_TOKEN")}}},26:function(t,e,n){"use strict";var r=n(55),o=n.n(r),a=n(51),c=o.a.create({baseURL:Object(a.a)()});e.a=c},27:function(t,e,n){"use strict";var r=n(8),o=n.n(r),a=n(65),c=n(24),s=n(25);function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){o()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e.a=function(t){var e,n=t.token,r=t.spotId,i=Object(s.a)().openWebAccessToken;return u(u({},c.k?o()({},c.b,i):{}),{},(e={},o()(e,c.e,window.__SPOTIM_PAGE_VIEW_ID__),o()(e,c.c,Object(a.getStorageDeviceUuid)().uuid||""),o()(e,c.g,n),o()(e,c.f,r),e))}},30:function(t,e,n){"use strict";var r=n(7),o=n.n(r),a=n(18),c=n.n(a),s=o.a.get("spotId"),i=c()(s,"registration",{version:"v1.15.10"});e.a=i},33:function(t,e,n){"use strict";var r=n(22),o=n.n(r),a=n(23),c=n.n(a),s=n(16),i=n.n(s),u=n(17),d=n.n(u),f=n(4),p=n(26),l=n(27),g=n(25),O=n(24),b=n(30);function w(t){try{localStorage.setItem("SPOTIM_DEVICE_V2",t)}catch(t){b.a.error("setDeviceV2",t)}}var v=function(){var t=c()(o.a.mark((function t(e){var n,r,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.spotId,!O.k&&!O.l){t.next=5;break}return t.abrupt("return",new Promise(function(){var t=c()(o.a.mark((function t(e){var r,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d()("v1.0.0/authentication/current-user",{method:"POST",headers:{"x-spot-id":n,"x-real-user-mode":"true"}});case 2:r=t.sent,(a=Object(s.parseUser)(r)).isRegistered&&Object(f.dispatchSpotimEvent)("spot-im-post-login",{currentUser:{email:a.email||"",socialNetworks:a.socialNetworks||[],username:a.username||""}}),e(a);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:return t.next=7,i.a.getAsyncToken();case 7:return r=t.sent,a=r.token,t.abrupt("return",new Promise((function(t,e){p.a.post("me/login",{spot_id:n},{method:"POST",headers:Object(l.a)({spotId:n,token:a})}).then(function(){var n=c()(o.a.mark((function n(r){var a,c,i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:!1===(null==r||null===(a=r.data)||void 0===a?void 0:a.success)&&(c=new Error("Login failed due to ".concat(r.data.type)),b.a.error("login",c),e(new Error("Login failed due to ".concat(r.data.type," with code: ").concat(r.data.code," and status: ").concat(r.data.status)))),Object(g.b)({accessToken:r.headers[O.a],openWebAccessToken:r.headers[O.b]}),w(r.headers[O.d]),(i=Object(s.parseUser)(r.data)).isRegistered&&Object(f.dispatchSpotimEvent)("spot-im-post-login",{currentUser:{email:i.email||"",socialNetworks:i.socialNetworks||[],username:i.username||""}}),t(i);case 6:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()).catch((function(t){b.a.error("login",t),e(new Error("Login failed due to with error: ".concat(t)))}))})));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();e.a=v},38:function(t,e,n){"use strict";var r=n(22),o=n.n(r),a=n(23),c=n.n(a),s=n(26),i=n(16),u=n.n(i),d=n(27),f=n(25),p=n(24);e.a=function(t){var e=t.spotId,n=t.token;return new Promise(function(){var t=c()(o.a.mark((function t(r){var a,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.getAsyncToken();case 2:a=t.sent,c=a.networkId,s.a.post("me/network-token/".concat(c),{spot_id:e},{method:"POST",headers:Object(d.a)({spotId:e,token:n})}).then((function(t){Object(f.b)({accessToken:t.headers[p.a],openWebAccessToken:t.headers[p.b]});var e=t.data,n=e.network_id,o=e.token;u.a.setToken(o,n),r({token:o})}));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},44:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(4),o=null;function a(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=console).log.apply(e,["%cSpot.IM ".concat(t),"background: #307fe2; color: white;"].concat(r))}function c(t){var e=function(){try{if(null===o){var t=new URLSearchParams(Object(r.getLocation)().search);if((o=t.get("SPOTIM_DEBUG_API".toLowerCase()))||(o=window.SPOTIM_DEBUG_API),!o)try{o=window.localStorage.getItem("SPOTIM_DEBUG_API")}catch(t){}o||(o=""),o=o.split(",").map((function(t){return t.toLowerCase()}))}return o}catch(t){return[]}}();return e.indexOf("*")>-1||e.indexOf(t.toLowerCase())>-1?a.bind(null,t):function(){}}},52:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return i}));var r=n(30),o=n(44),a=Object(o.a)("SSO"),c=function(t){var e;try{e=localStorage.getItem("OWֹֹ_EXTERNAL_USER_ID")||""}catch(t){var n="SSO - cannot get ".concat("OWֹֹ_EXTERNAL_USER_ID"," from local storage: ").concat(t);a(n),r.a.error("startSSO",n)}return t!==e},s=function(t){try{localStorage.setItem("OWֹֹ_EXTERNAL_USER_ID",t)}catch(t){var e="SSO - cannot set ".concat("OWֹֹ_EXTERNAL_USER_ID"," in local storage: ").concat(t);a(e),r.a.error("startSSO",e)}},i=function(){try{localStorage.removeItem("OWֹֹ_EXTERNAL_USER_ID")}catch(e){var t="SSO - cannot set ".concat("OWֹֹ_EXTERNAL_USER_ID"," in local storage: ").concat(e);a(t),r.a.error("startSSO",t)}}},71:function(t,e,n){"use strict";n.r(e);var r=n(22),o=n.n(r),a=n(8),c=n.n(a),s=n(23),i=n.n(s),u=n(16),d=n.n(u),f=n(7),p=n.n(f),l=n(17),g=n.n(l),O=n(26),b=n(38),w=n(33),v=n(27),h=n(25),m=n(24),_=n(30),S=n(52),k=n(44);function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var j=Object(k.a)("Registration"),P=function(){var t=i()(o.a.mark((function t(){var e,n,r,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j("Logout started"),t.next=3,d.a.getAsyncToken();case 3:return e=t.sent,n=e.token,r=p.a.get("spotId"),t.next=8,d.a.getAsyncUser();case 8:if(a=t.sent,a.isRegistered){t.next=14;break}return t.abrupt("return",Promise.resolve(a));case 14:if(!m.k){t.next=18;break}return t.abrupt("return",new Promise(function(){var t=i()(o.a.mark((function t(e){var n,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g()("v1.0.0/authentication/logout",{method:"POST",headers:{"x-spot-id":r}});case 2:n=t.sent,a=Object(u.parseUser)(n),Object(S.b)(),d.a.set(y(y({},a),{},{isSuperAdmin:!1})),j("Logout succeed, new current user is: ",a),e(a);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 18:return t.abrupt("return",new Promise((function(t,e){O.a.post("me/logout",{spot_id:r},{method:"POST",headers:Object(v.a)({spotId:r,token:n})}).then(function(){var c=i()(o.a.mark((function c(s){var i,u,f,p,l;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return!1===(null==s||null===(i=s.data)||void 0===i?void 0:i.success)&&(u=new Error("Logout failed due to ".concat(s.data.type," with code: ").concat(s.data.code," and status: ").concat(s.data.status)),_.a.error("logout",u),e(new Error("Logout failed due to ".concat(s.data.type," with code: ").concat(s.data.code," and status: ").concat(s.data.status)))),Object(h.b)({accessToken:s.headers[m.a],openWebAccessToken:s.headers[m.b]}),o.next=4,Object(b.a)({spotId:r,token:n});case 4:return f=o.sent,p=f.token,d.a.setToken(p),o.next=9,Object(w.a)({spotId:r});case 9:l=o.sent,Object(S.b)(),d.a.set(y(y({},l),{},{isSuperAdmin:!1})),j("Logout succeed, new current user is: ",a),t(l);case 14:case"end":return o.stop()}}),c)})));return function(t){return c.apply(this,arguments)}}()).catch((function(t){_.a.error("logout",t),j("Logout failed with: ",t),e(new Error("Logout failed due to with error: ".concat(t)))}))})));case 19:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e.default=P}}]);
//# sourceMappingURL=registration-logout-bundle.js.map